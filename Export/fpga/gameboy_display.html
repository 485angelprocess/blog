<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <style>
  @font-face {
  font-family: octicons-link;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body .octicon {
  display: inline-block;
  fill: currentColor;
  vertical-align: text-bottom;
}

.markdown-body .anchor {
  float: left;
  line-height: 1;
  margin-left: -20px;
  padding-right: 4px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  color: #1b1f23;
  vertical-align: middle;
  visibility: hidden;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  visibility: visible;
}

.markdown-body {
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #24292e;
  line-height: 1.5;
  font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;
  font-size: 16px;
  line-height: 1.5;
  word-wrap: break-word;
}

.markdown-body .pl-c {
  color: #6a737d;
}

.markdown-body .pl-c1,
.markdown-body .pl-s .pl-v {
  color: #005cc5;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
  color: #6f42c1;
}

.markdown-body .pl-s .pl-s1,
.markdown-body .pl-smi {
  color: #24292e;
}

.markdown-body .pl-ent {
  color: #22863a;
}

.markdown-body .pl-k {
  color: #d73a49;
}

.markdown-body .pl-pds,
.markdown-body .pl-s,
.markdown-body .pl-s .pl-pse .pl-s1,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sra,
.markdown-body .pl-sr .pl-sre {
  color: #032f62;
}

.markdown-body .pl-smw,
.markdown-body .pl-v {
  color: #e36209;
}

.markdown-body .pl-bu {
  color: #b31d28;
}

.markdown-body .pl-ii {
  background-color: #b31d28;
  color: #fafbfc;
}

.markdown-body .pl-c2 {
  background-color: #d73a49;
  color: #fafbfc;
}

.markdown-body .pl-c2:before {
  content: "^M";
}

.markdown-body .pl-sr .pl-cce {
  color: #22863a;
  font-weight: 700;
}

.markdown-body .pl-ml {
  color: #735c0f;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
  color: #005cc5;
  font-weight: 700;
}

.markdown-body .pl-mi {
  color: #24292e;
  font-style: italic;
}

.markdown-body .pl-mb {
  color: #24292e;
  font-weight: 700;
}

.markdown-body .pl-md {
  background-color: #ffeef0;
  color: #b31d28;
}

.markdown-body .pl-mi1 {
  background-color: #f0fff4;
  color: #22863a;
}

.markdown-body .pl-mc {
  background-color: #ffebda;
  color: #e36209;
}

.markdown-body .pl-mi2 {
  background-color: #005cc5;
  color: #f6f8fa;
}

.markdown-body .pl-mdr {
  color: #6f42c1;
  font-weight: 700;
}

.markdown-body .pl-ba {
  color: #586069;
}

.markdown-body .pl-sg {
  color: #959da5;
}

.markdown-body .pl-corl {
  color: #032f62;
  text-decoration: underline;
}

.markdown-body details {
  display: block;
}

.markdown-body summary {
  display: list-item;
}

.markdown-body a {
  background-color: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline-width: 0;
}

.markdown-body strong {
  font-weight: inherit;
  font-weight: bolder;
}

.markdown-body h1 {
  font-size: 2em;
  margin: .67em 0;
}

.markdown-body img {
  border-style: none;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace,monospace;
  font-size: 1em;
}

.markdown-body hr {
  box-sizing: content-box;
  height: 0;
  overflow: visible;
}

.markdown-body input {
  font: inherit;
  margin: 0;
}

.markdown-body input {
  overflow: visible;
}

.markdown-body [type=checkbox] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body * {
  box-sizing: border-box;
}

.markdown-body input {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
}

.markdown-body a {
  color: #0366d6;
  text-decoration: none;
}

.markdown-body a:hover {
  text-decoration: underline;
}

.markdown-body strong {
  font-weight: 600;
}

.markdown-body hr {
  background: transparent;
  border: 0;
  border-bottom: 1px solid #dfe2e5;
  height: 0;
  margin: 15px 0;
  overflow: hidden;
}

.markdown-body hr:before {
  content: "";
  display: table;
}

.markdown-body hr:after {
  clear: both;
  content: "";
  display: table;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body details summary {
  cursor: pointer;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-bottom: 0;
  margin-top: 0;
}

.markdown-body h1 {
  font-size: 32px;
}

.markdown-body h1,
.markdown-body h2 {
  font-weight: 600;
}

.markdown-body h2 {
  font-size: 24px;
}

.markdown-body h3 {
  font-size: 20px;
}

.markdown-body h3,
.markdown-body h4 {
  font-weight: 600;
}

.markdown-body h4 {
  font-size: 16px;
}

.markdown-body h5 {
  font-size: 14px;
}

.markdown-body h5,
.markdown-body h6 {
  font-weight: 600;
}

.markdown-body h6 {
  font-size: 12px;
}

.markdown-body p {
  margin-bottom: 10px;
  margin-top: 0;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ol,
.markdown-body ul {
  margin-bottom: 0;
  margin-top: 0;
  padding-left: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ol ol ol,
.markdown-body ol ul ol,
.markdown-body ul ol ol,
.markdown-body ul ul ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre {
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-bottom: 0;
  margin-top: 0;
}

.markdown-body input::-webkit-inner-spin-button,
.markdown-body input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  appearance: none;
  margin: 0;
}

.markdown-body .border {
  border: 1px solid #e1e4e8!important;
}

.markdown-body .border-0 {
  border: 0!important;
}

.markdown-body .border-bottom {
  border-bottom: 1px solid #e1e4e8!important;
}

.markdown-body .rounded-1 {
  border-radius: 3px!important;
}

.markdown-body .bg-white {
  background-color: #fff!important;
}

.markdown-body .bg-gray-light {
  background-color: #fafbfc!important;
}

.markdown-body .text-gray-light {
  color: #6a737d!important;
}

.markdown-body .mb-0 {
  margin-bottom: 0!important;
}

.markdown-body .my-2 {
  margin-bottom: 8px!important;
  margin-top: 8px!important;
}

.markdown-body .pl-0 {
  padding-left: 0!important;
}

.markdown-body .py-0 {
  padding-bottom: 0!important;
  padding-top: 0!important;
}

.markdown-body .pl-1 {
  padding-left: 4px!important;
}

.markdown-body .pl-2 {
  padding-left: 8px!important;
}

.markdown-body .py-2 {
  padding-bottom: 8px!important;
  padding-top: 8px!important;
}

.markdown-body .pl-3,
.markdown-body .px-3 {
  padding-left: 16px!important;
}

.markdown-body .px-3 {
  padding-right: 16px!important;
}

.markdown-body .pl-4 {
  padding-left: 24px!important;
}

.markdown-body .pl-5 {
  padding-left: 32px!important;
}

.markdown-body .pl-6 {
  padding-left: 40px!important;
}

.markdown-body .f6 {
  font-size: 12px!important;
}

.markdown-body .lh-condensed {
  line-height: 1.25!important;
}

.markdown-body .text-bold {
  font-weight: 600!important;
}

.markdown-body:before {
  content: "";
  display: table;
}

.markdown-body:after {
  clear: both;
  content: "";
  display: table;
}

.markdown-body>:first-child {
  margin-top: 0!important;
}

.markdown-body>:last-child {
  margin-bottom: 0!important;
}

.markdown-body a:not([href]) {
  color: inherit;
  text-decoration: none;
}

.markdown-body blockquote,
.markdown-body dl,
.markdown-body ol,
.markdown-body p,
.markdown-body pre,
.markdown-body table,
.markdown-body ul {
  margin-bottom: 16px;
  margin-top: 0;
}

.markdown-body hr {
  background-color: #e1e4e8;
  border: 0;
  height: .25em;
  margin: 24px 0;
  padding: 0;
}

.markdown-body blockquote {
  border-left: .25em solid #dfe2e5;
  color: #6a737d;
  padding: 0 1em;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #fafbfc;
  border: 1px solid #c6cbd1;
  border-bottom-color: #959da5;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #959da5;
  color: #444d56;
  display: inline-block;
  font-size: 11px;
  line-height: 10px;
  padding: 3px 5px;
  vertical-align: middle;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  font-weight: 600;
  line-height: 1.25;
  margin-bottom: 16px;
  margin-top: 24px;
}

.markdown-body h1 {
  font-size: 2em;
}

.markdown-body h1,
.markdown-body h2 {
  border-bottom: 1px solid #eaecef;
  padding-bottom: .3em;
}

.markdown-body h2 {
  font-size: 1.5em;
}

.markdown-body h3 {
  font-size: 1.25em;
}

.markdown-body h4 {
  font-size: 1em;
}

.markdown-body h5 {
  font-size: .875em;
}

.markdown-body h6 {
  color: #6a737d;
  font-size: .85em;
}

.markdown-body ol,
.markdown-body ul {
  padding-left: 2em;
}

.markdown-body ol ol,
.markdown-body ol ul,
.markdown-body ul ol,
.markdown-body ul ul {
  margin-bottom: 0;
  margin-top: 0;
}

.markdown-body li {
  word-wrap: break-all;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body li+li {
  margin-top: .25em;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  font-size: 1em;
  font-style: italic;
  font-weight: 600;
  margin-top: 16px;
  padding: 0;
}

.markdown-body dl dd {
  margin-bottom: 16px;
  padding: 0 16px;
}

.markdown-body table {
  display: block;
  overflow: auto;
  width: 100%;
}

.markdown-body table th {
  font-weight: 600;
}

.markdown-body table td,
.markdown-body table th {
  border: 1px solid #dfe2e5;
  padding: 6px 13px;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #c6cbd1;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f6f8fa;
}

.markdown-body img {
  background-color: #fff;
  box-sizing: content-box;
  max-width: 100%;
}

.markdown-body img[align=right] {
  padding-left: 20px;
}

.markdown-body img[align=left] {
  padding-right: 20px;
}

.markdown-body code {
  background-color: rgba(27,31,35,.05);
  border-radius: 3px;
  font-size: 85%;
  margin: 0;
  padding: .2em .4em;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre>code {
  background: transparent;
  border: 0;
  font-size: 100%;
  margin: 0;
  padding: 0;
  white-space: pre;
  word-break: normal;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body .highlight pre,
.markdown-body pre {
  background-color: #f6f8fa;
  border-radius: 3px;
  font-size: 85%;
  line-height: 1.45;
  overflow: auto;
  padding: 16px;
}

.markdown-body pre code {
  background-color: transparent;
  border: 0;
  display: inline;
  line-height: inherit;
  margin: 0;
  max-width: auto;
  overflow: visible;
  padding: 0;
  word-wrap: normal;
}

.markdown-body .commit-tease-sha {
  color: #444d56;
  display: inline-block;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
  font-size: 90%;
}

.markdown-body .blob-wrapper {
  border-bottom-left-radius: 3px;
  border-bottom-right-radius: 3px;
  overflow-x: auto;
  overflow-y: hidden;
}

.markdown-body .blob-wrapper-embedded {
  max-height: 240px;
  overflow-y: auto;
}

.markdown-body .blob-num {
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  color: rgba(27,31,35,.3);
  cursor: pointer;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
  font-size: 12px;
  line-height: 20px;
  min-width: 50px;
  padding-left: 10px;
  padding-right: 10px;
  text-align: right;
  user-select: none;
  vertical-align: top;
  white-space: nowrap;
  width: 1%;
}

.markdown-body .blob-num:hover {
  color: rgba(27,31,35,.6);
}

.markdown-body .blob-num:before {
  content: attr(data-line-number);
}

.markdown-body .blob-code {
  line-height: 20px;
  padding-left: 10px;
  padding-right: 10px;
  position: relative;
  vertical-align: top;
}

.markdown-body .blob-code-inner {
  color: #24292e;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
  font-size: 12px;
  overflow: visible;
  white-space: pre;
  word-wrap: normal;
}

.markdown-body .pl-token.active,
.markdown-body .pl-token:hover {
  background: #ffea7f;
  cursor: pointer;
}

.markdown-body kbd {
  background-color: #fafbfc;
  border: 1px solid #d1d5da;
  border-bottom-color: #c6cbd1;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #c6cbd1;
  color: #444d56;
  display: inline-block;
  font: 11px SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
  line-height: 10px;
  padding: 3px 5px;
  vertical-align: middle;
}

.markdown-body :checked+.radio-label {
  border-color: #0366d6;
  position: relative;
  z-index: 1;
}

.markdown-body .tab-size[data-tab-size="1"] {
  -moz-tab-size: 1;
  tab-size: 1;
}

.markdown-body .tab-size[data-tab-size="2"] {
  -moz-tab-size: 2;
  tab-size: 2;
}

.markdown-body .tab-size[data-tab-size="3"] {
  -moz-tab-size: 3;
  tab-size: 3;
}

.markdown-body .tab-size[data-tab-size="4"] {
  -moz-tab-size: 4;
  tab-size: 4;
}

.markdown-body .tab-size[data-tab-size="5"] {
  -moz-tab-size: 5;
  tab-size: 5;
}

.markdown-body .tab-size[data-tab-size="6"] {
  -moz-tab-size: 6;
  tab-size: 6;
}

.markdown-body .tab-size[data-tab-size="7"] {
  -moz-tab-size: 7;
  tab-size: 7;
}

.markdown-body .tab-size[data-tab-size="8"] {
  -moz-tab-size: 8;
  tab-size: 8;
}

.markdown-body .tab-size[data-tab-size="9"] {
  -moz-tab-size: 9;
  tab-size: 9;
}

.markdown-body .tab-size[data-tab-size="10"] {
  -moz-tab-size: 10;
  tab-size: 10;
}

.markdown-body .tab-size[data-tab-size="11"] {
  -moz-tab-size: 11;
  tab-size: 11;
}

.markdown-body .tab-size[data-tab-size="12"] {
  -moz-tab-size: 12;
  tab-size: 12;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 .2em .25em -1.6em;
  vertical-align: middle;
}

.markdown-body hr {
  border-bottom-color: #eee;
}

.markdown-body .pl-0 {
  padding-left: 0!important;
}

.markdown-body .pl-1 {
  padding-left: 4px!important;
}

.markdown-body .pl-2 {
  padding-left: 8px!important;
}

.markdown-body .pl-3 {
  padding-left: 16px!important;
}

.markdown-body .pl-4 {
  padding-left: 24px!important;
}

.markdown-body .pl-5 {
  padding-left: 32px!important;
}

.markdown-body .pl-6 {
  padding-left: 40px!important;
}

.markdown-body .pl-7 {
  padding-left: 48px!important;
}

.markdown-body .pl-8 {
  padding-left: 64px!important;
}

.markdown-body .pl-9 {
  padding-left: 80px!important;
}

.markdown-body .pl-10 {
  padding-left: 96px!important;
}

.markdown-body .pl-11 {
  padding-left: 112px!important;
}

.markdown-body .pl-12 {
  padding-left: 128px!important;
}

/*# sourceURL=webpack://./node_modules/github-markdown-css/github-markdown.css */
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL25vZGVfbW9kdWxlcy9naXRodWItbWFya2Rvd24tY3NzL2dpdGh1Yi1tYXJrZG93bi5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSwwQkFBMEI7RUFDMUIsMkRBQXF0RTtBQUN2dEU7O0FBRUE7RUFDRSxxQkFBcUI7RUFDckIsa0JBQWtCO0VBQ2xCLDJCQUEyQjtBQUM3Qjs7QUFFQTtFQUNFLFdBQVc7RUFDWCxjQUFjO0VBQ2Qsa0JBQWtCO0VBQ2xCLGtCQUFrQjtBQUNwQjs7QUFFQTtFQUNFLGFBQWE7QUFDZjs7QUFFQTs7Ozs7O0VBTUUsY0FBYztFQUNkLHNCQUFzQjtFQUN0QixrQkFBa0I7QUFDcEI7O0FBRUE7Ozs7OztFQU1FLHFCQUFxQjtBQUN2Qjs7QUFFQTs7Ozs7O0VBTUUsbUJBQW1CO0FBQ3JCOztBQUVBO0VBQ0UsMEJBQTBCO0VBQzFCLDhCQUE4QjtFQUM5QixjQUFjO0VBQ2QsZ0JBQWdCO0VBQ2hCLGtJQUFrSTtFQUNsSSxlQUFlO0VBQ2YsZ0JBQWdCO0VBQ2hCLHFCQUFxQjtBQUN2Qjs7QUFFQTtFQUNFLGNBQWM7QUFDaEI7O0FBRUE7O0VBRUUsY0FBYztBQUNoQjs7QUFFQTs7RUFFRSxjQUFjO0FBQ2hCOztBQUVBOztFQUVFLGNBQWM7QUFDaEI7O0FBRUE7RUFDRSxjQUFjO0FBQ2hCOztBQUVBO0VBQ0UsY0FBYztBQUNoQjs7QUFFQTs7Ozs7OztFQU9FLGNBQWM7QUFDaEI7O0FBRUE7O0VBRUUsY0FBYztBQUNoQjs7QUFFQTtFQUNFLGNBQWM7QUFDaEI7O0FBRUE7RUFDRSx5QkFBeUI7RUFDekIsY0FBYztBQUNoQjs7QUFFQTtFQUNFLHlCQUF5QjtFQUN6QixjQUFjO0FBQ2hCOztBQUVBO0VBQ0UsYUFBYTtBQUNmOztBQUVBO0VBQ0UsY0FBYztFQUNkLGdCQUFnQjtBQUNsQjs7QUFFQTtFQUNFLGNBQWM7QUFDaEI7O0FBRUE7OztFQUdFLGNBQWM7RUFDZCxnQkFBZ0I7QUFDbEI7O0FBRUE7RUFD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 */
  </style>
  <style>
  /**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}

/*# sourceURL=webpack://./node_modules/prismjs/themes/prism.css */
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL25vZGVfbW9kdWxlcy9wcmlzbWpzL3RoZW1lcy9wcmlzbS5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7RUFJRTs7QUFFRjs7Q0FFQyxZQUFZO0NBQ1osZ0JBQWdCO0NBQ2hCLHdCQUF3QjtDQUN4QixzRUFBc0U7Q0FDdEUsY0FBYztDQUNkLGdCQUFnQjtDQUNoQixnQkFBZ0I7Q0FDaEIsb0JBQW9CO0NBQ3BCLGtCQUFrQjtDQUNsQixpQkFBaUI7Q0FDakIsZ0JBQWdCOztDQUVoQixnQkFBZ0I7Q0FDaEIsY0FBYztDQUNkLFdBQVc7O0NBRVgscUJBQXFCO0NBQ3JCLGtCQUFrQjtDQUNsQixpQkFBaUI7Q0FDakIsYUFBYTtBQUNkOztBQUVBOztDQUVDLGlCQUFpQjtDQUNqQixtQkFBbUI7QUFDcEI7O0FBRUE7O0NBRUMsaUJBQWlCO0NBQ2pCLG1CQUFtQjtBQUNwQjs7QUFFQTtDQUNDOztFQUVDLGlCQUFpQjtDQUNsQjtBQUNEOztBQUVBLGdCQUFnQjtBQUNoQjtDQUNDLFlBQVk7Q0FDWixjQUFjO0NBQ2QsY0FBYztBQUNmOztBQUVBOztDQUVDLG1CQUFtQjtBQUNwQjs7QUFFQSxnQkFBZ0I7QUFDaEI7Q0FDQyxhQUFhO0NBQ2IsbUJBQW1CO0NBQ25CLG1CQUFtQjtBQUNwQjs7QUFFQTs7OztDQUlDLGdCQUFnQjtBQUNqQjs7QUFFQTtDQUNDLFdBQVc7QUFDWjs7QUFFQTtDQUNDLFdBQVc7QUFDWjs7QUFFQTs7Ozs7OztDQU9DLFdBQVc7QUFDWjs7QUFFQTs7Ozs7O0NBTUMsV0FBVztBQUNaOztBQUVBOzs7OztDQUtDLGNBQWM7Q0FDZCxvRUFBb0U7Q0FDcEUsaUNBQWlDO0FBQ2xDOztBQUVBOzs7Q0FHQyxXQUFXO0FBQ1o7O0FBRUE7O0NBRUMsY0FBYztBQUNmOztBQUVBOzs7Q0FHQyxXQUFXO0FBQ1o7O0FBRUE7O0NBRUMsaUJBQWlCO0FBQ2xCO0FBQ0E7Q0FDQyxrQkFBa0I7QUFDbkI7O0FBRUE7Q0FDQyxZQUFZO0FBQ2IiLCJzb3VyY2VSb290IjoiIn0= */
  </style>
  <style>
  
  </style>
  <style>
    .markdown-body {
      font-family: -apple-system,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;
      box-sizing: border-box;
      min-width: 200px;
      max-width: 980px;
      margin: 0 auto;
      padding: 45px;
    }

    @media not print {
      .markdown-body {
        padding: 45px;
      }

      @media (max-width: 767px) {
        .markdown-body {
          padding: 15px;
        }
      }
    }

    .hf-container {
      color: #24292e;
      line-height: 1.3;
    }

    .markdown-body .highlight pre,
    .markdown-body pre {
      white-space: pre-wrap;
    }
    .markdown-body table {
      display: table;
    }
    .markdown-body img[data-align="center"] {
      display: block;
      margin: 0 auto;
    }
    .markdown-body img[data-align="right"] {
      display: block;
      margin: 0 0 0 auto;
    }
    .markdown-body li.task-list-item {
      list-style-type: none;
    }
    .markdown-body li > [type=checkbox] {
      margin: 0 0 0 -1.3em;
    }
    .markdown-body input[type="checkbox"] ~ p {
      margin-top: 0;
      display: inline-block;
    }
    .markdown-body ol ol,
    .markdown-body ul ol {
      list-style-type: decimal;
    }
    .markdown-body ol ol ol,
    .markdown-body ol ul ol,
    .markdown-body ul ol ol,
    .markdown-body ul ul ol {
      list-style-type: decimal;
    }
  </style>
  <style>.markdown-body a.footnote-ref {
  text-decoration: none;
}

.footnotes {
  font-size: .85em;
  opacity: .8;
}

.footnotes li[role="doc-endnote"] {
  position: relative;
}

.footnotes .footnote-back {
  position: absolute;
  font-family: initial;
  top: .2em;
  right: 1em;
  text-decoration: none;
}

.inline-math.invalid,
.multiple-math.invalid {
  color: rgb(255, 105, 105);
}

.toc-container {
  width: 100%;
}

.toc-container .toc-title {
  font-weight: 700;
  font-size: 1.2em;
  margin-bottom: 0;
}

.toc-container li,
.toc-container ul,
.toc-container ul li {
  list-style: none !important;
}

.toc-container > ul {
  padding-left: 0;
}

.toc-container ul li span {
  display : flex;
}

.toc-container ul li span a {
  color: inherit;
  text-decoration: none;
}
.toc-container ul li span a:hover {
  color: inherit;
  text-decoration: none;
}

.toc-container ul li span span.dots {
  flex: 1;
  height: 0.65em;
  margin: 0 10px;
  border-bottom: 2px dotted black;
}

/*# sourceURL=webpack://./src/muya/lib/assets/styles/exportStyle.css */
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9tdXlhL2xpYi9hc3NldHMvc3R5bGVzL2V4cG9ydFN0eWxlLmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLHFCQUFxQjtBQUN2Qjs7QUFFQTtFQUNFLGdCQUFnQjtFQUNoQixXQUFXO0FBQ2I7O0FBRUE7RUFDRSxrQkFBa0I7QUFDcEI7O0FBRUE7RUFDRSxrQkFBa0I7RUFDbEIsb0JBQW9CO0VBQ3BCLFNBQVM7RUFDVCxVQUFVO0VBQ1YscUJBQXFCO0FBQ3ZCOztBQUVBOztFQUVFLHlCQUF5QjtBQUMzQjs7QUFFQTtFQUNFLFdBQVc7QUFDYjs7QUFFQTtFQUNFLGdCQUFnQjtFQUNoQixnQkFBZ0I7RUFDaEIsZ0JBQWdCO0FBQ2xCOztBQUVBOzs7RUFHRSwyQkFBMkI7QUFDN0I7O0FBRUE7RUFDRSxlQUFlO0FBQ2pCOztBQUVBO0VBQ0UsY0FBYztBQUNoQjs7QUFFQTtFQUNFLGNBQWM7RUFDZCxxQkFBcUI7QUFDdkI7QUFDQTtFQUNFLGNBQWM7RUFDZCxxQkFBcUI7QUFDdkI7O0FBRUE7RUFDRSxPQUFPO0VBQ1AsY0FBYztFQUNkLGNBQWM7RUFDZCwrQkFBK0I7QUFDakMiLCJzb3VyY2VSb290IjoiIn0= */</style>
  <style>.markdown-body{}pre.front-matter{display:none!important;}</style>
</head>
<body>
  <article class="markdown-body"><h1 class="atx" id="gameboy-emulator---picture-processing-unit---display-output">Gameboy Emulator - Picture Processing Unit - Display Output</h1>
<p>The PPU is the rendering end of the gameboy/gameboy color. It uses  16KB of VRAM (8KB on the original gameboy) to render to a 160x144 pixel LCD.  The unit manages visual data, and renders backgrounds, window and sprites to the screen.</p>
<h2 class="atx" id="vga-output">VGA Output</h2>
<p>To start with this emulation, I want to be able to see the output. Since the FPGA board I'm using has an build in VGA output port, I'd like to be able to render the LCD panel to a VGA monitor. The gameboy LCD refreshes at 59.7275 frames per second, so I should be able to get away with a 60hz standard.</p>
<p>To start I made a basic class to contain timing information:</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">class</span> <span class="token class-name">VideoRegion</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> active<span class="token punctuation">,</span> front_porch<span class="token punctuation">,</span> sync<span class="token punctuation">,</span> back_porch<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>active <span class="token operator">=</span> active
        self<span class="token punctuation">.</span>front_porch <span class="token operator">=</span> front_porch
        self<span class="token punctuation">.</span>sync <span class="token operator">=</span> sync
        self<span class="token punctuation">.</span>back_porch <span class="token operator">=</span> back_porch

    <span class="token keyword">def</span> <span class="token function">total</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>active <span class="token operator">+</span> self<span class="token punctuation">.</span>front_porch <span class="token operator">+</span> self<span class="token punctuation">.</span>sync <span class="token operator">+</span> self<span class="token punctuation">.</span>back_porch</code></pre>
<p>Then I created an amaranth module which can will keep track of which part of the video we're on. This module can be reused for horizontal and vertical timing. For horizontal timing the pixel clock is used as the input, for the vertical timing the horizontal overflow pulse is used.</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">class</span> <span class="token class-name">VideoState</span><span class="token punctuation">(</span>enum<span class="token punctuation">.</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Represents section of video
    """</span>
    ACTIVE  <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># Video is currently sending</span>
    FP      <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment"># Front porch</span>
    SYNC    <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment"># Sync section</span>
    BP      <span class="token operator">=</span> <span class="token number">3</span> <span class="token comment"># Back porch</span>

<span class="token keyword">class</span> <span class="token class-name">VideoCounter</span><span class="token punctuation">(</span>wiring<span class="token punctuation">.</span>Component<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Horizontal or vertical video counter
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> region<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>region <span class="token operator">=</span> region
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">"clk_en"</span><span class="token punctuation">:</span> In<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># Pixel clock or horizontal clock</span>
            <span class="token string">"state"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span>VideoState<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"ovf"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">elaborate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> platform<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> Module<span class="token punctuation">(</span><span class="token punctuation">)</span>

        counter <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>region<span class="token punctuation">.</span>total<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        ovf <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>

        m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> ovf<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>counter <span class="token operator">==</span> self<span class="token punctuation">.</span>region<span class="token punctuation">.</span>total<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>ovf<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>ovf <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>clk_en<span class="token punctuation">)</span>


        <span class="token comment"># Map video section</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>counter <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>region<span class="token punctuation">.</span>back_porch<span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>VideoState<span class="token punctuation">.</span>BP<span class="token punctuation">)</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>Elif<span class="token punctuation">(</span>counter <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>region<span class="token punctuation">.</span>back_porch <span class="token operator">+</span> self<span class="token punctuation">.</span>region<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>VideoState<span class="token punctuation">.</span>ACTIVE<span class="token punctuation">)</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>Elif<span class="token punctuation">(</span>counter <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>region<span class="token punctuation">.</span>back_porch <span class="token operator">+</span> self<span class="token punctuation">.</span>region<span class="token punctuation">.</span>active <span class="token operator">+</span> self<span class="token punctuation">.</span>region<span class="token punctuation">.</span>sync<span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>VideoState<span class="token punctuation">.</span>FP<span class="token punctuation">)</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>VideoState<span class="token punctuation">.</span>SYNC<span class="token punctuation">)</span>

        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>clk_en<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ovf<span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> m</code></pre>
<p>With the region out of the way, I just need a way to stream in data and make sure it aligns with video being sent out. I start with a signature and pixel container:</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">from</span> amaranth<span class="token punctuation">.</span>lib <span class="token keyword">import</span> wiring<span class="token punctuation">,</span> data
<span class="token keyword">from</span> amaranth<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>wiring <span class="token keyword">import</span> In<span class="token punctuation">,</span> Out

<span class="token keyword">def</span> <span class="token function">pixel_shape</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> data<span class="token punctuation">.</span>StructLayout<span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">"r"</span><span class="token punctuation">:</span> width<span class="token punctuation">,</span>
        <span class="token string">"g"</span><span class="token punctuation">:</span> width<span class="token punctuation">,</span>
        <span class="token string">"b"</span><span class="token punctuation">:</span> width
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Stream</span><span class="token punctuation">(</span>wiring<span class="token punctuation">.</span>Signature<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> shape<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">"data"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"valid"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"ready"</span><span class="token punctuation">:</span> In<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"vsync"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>I start with driver module. It takes a stream of pixels in, and outputs the vga data and sync signals. The polarity flag is used since some resolutions expect a normally on sync, others a normally off sync. Most monitors don't seem to use this polarity anymore, but it's good to have consistent. The pixel division allows us to set the pixel clock as a ratio of the input clock. For example an 800x600 resolution at 60Hz has a 40MHz clock, so we can use a synthesized clock of 120MHz and divide by 3.</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">class</span> <span class="token class-name">Polarity</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    POS <span class="token operator">=</span> <span class="token number">0</span>
    NEG <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">class</span> <span class="token class-name">VgaDriver</span><span class="token punctuation">(</span>wiring<span class="token punctuation">.</span>Component<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pix_divide<span class="token punctuation">,</span> 
                        hregion<span class="token punctuation">,</span> 
                        vregion<span class="token punctuation">,</span>
                        polarity <span class="token operator">=</span> Polarity<span class="token punctuation">.</span>POS
                        shape <span class="token operator">=</span> signature<span class="token punctuation">.</span>PixelLayout<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>hregion <span class="token operator">=</span> hregion
        self<span class="token punctuation">.</span>vregion <span class="token operator">=</span> vregion
        self<span class="token punctuation">.</span>pix_divide <span class="token operator">=</span> pix_divide
        self<span class="token punctuation">.</span>polarity <span class="token operator">=</span> polarity

        <span class="token builtin">super</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">"consume"</span><span class="token punctuation">:</span> In<span class="token punctuation">(</span>Stream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"data"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"hsync"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"vsync"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>The pixel clock division is done using a simple counter.</p>
<pre><code class="fenced-code-block language-python"><span class="token comment"># Pixel clock divider</span>
pix_counter <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pix_divide<span class="token punctuation">)</span><span class="token punctuation">)</span>
pix_clk <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>

m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> pix_clk<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>pix_counter <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>pix_counter <span class="token operator">==</span> self<span class="token punctuation">.</span>pix_divide <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> pix_counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> pix_counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>pix_counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></code></pre>
<p>Then we can connect to our video region counters:</p>
<pre><code class="fenced-code-block language-python"><span class="token comment"># Horizontal region</span>
hcounter <span class="token operator">=</span> m<span class="token punctuation">.</span>submodules<span class="token punctuation">.</span>hcounter <span class="token operator">=</span> VideoCounter<span class="token punctuation">(</span>self<span class="token punctuation">.</span>hregion<span class="token punctuation">)</span>

m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> hcounter<span class="token punctuation">.</span>clk_en<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>pix_clk<span class="token punctuation">)</span>

<span class="token comment"># Vertical region</span>
vcounter <span class="token operator">=</span> m<span class="token punctuation">.</span>submodules<span class="token punctuation">.</span>vcounter <span class="token operator">=</span> VideoCounter<span class="token punctuation">(</span>self<span class="token punctuation">.</span>vregion<span class="token punctuation">)</span>

m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> vcounter<span class="token punctuation">.</span>clk_en<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>hcounter<span class="token punctuation">.</span>ovf<span class="token punctuation">)</span></code></pre>
<p>Since I want my video output to be aligned with the monitor refresh. To do this I block reading in from the stream if I receive a vsync, and only resume when I entered the sync region on the VGA side.</p>
<pre><code class="fenced-code-block language-python">input_enable <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>
video_active <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>

m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> video_active<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>
                <span class="token punctuation">(</span>hcounter<span class="token punctuation">.</span>state <span class="token operator">==</span> VideoState<span class="token punctuation">.</span>ACTIVE<span class="token punctuation">)</span> <span class="token operator">&amp;</span>
                <span class="token punctuation">(</span>vcounter<span class="token punctuation">.</span>state <span class="token operator">==</span> VideoState<span class="token punctuation">.</span>ACTIVE<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>input_enable <span class="token operator">&amp;</span> video_active<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>pix_clk<span class="token punctuation">)</span>

<span class="token comment"># Stop sending at end of frame</span>
<span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>valid <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>vsync<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> input_enable<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Reached end of output frame, data can be send when pixels are active</span>
<span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>vcounter<span class="token punctuation">.</span>state <span class="token operator">==</span> VideoState<span class="token punctuation">.</span>SYNC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> input_enable<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>video_active <span class="token operator">&amp;</span> input_enable<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Top 4 bits of each pixel</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>data<span class="token punctuation">.</span>r<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>data<span class="token punctuation">.</span>g<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>data<span class="token punctuation">.</span>b<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></code></pre>
<p>For certain VGA formats, some monitors will check the polarity of the hsync and vsync signals. </p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">if</span> self<span class="token punctuation">.</span>polarity <span class="token operator">==</span> Polarity<span class="token punctuation">.</span>POS<span class="token punctuation">:</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>hsync<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>hcounter<span class="token punctuation">.</span>state <span class="token operator">==</span> VideoState<span class="token punctuation">.</span>SYNC<span class="token punctuation">)</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>vsync<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>vcounter<span class="token punctuation">.</span>state <span class="token operator">==</span> VideoState<span class="token punctuation">.</span>SYNC<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>hsync<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>hcounter<span class="token punctuation">.</span>state <span class="token operator">!=</span> VideoState<span class="token punctuation">.</span>SYNC<span class="token punctuation">)</span>
    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>vsync<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>vcounter<span class="token punctuation">.</span>state <span class="token operator">!=</span> VideoState<span class="token punctuation">.</span>SYNC<span class="token punctuation">)</span></code></pre>
<p>I can convert this amaranth module to a vga module.</p>
<pre><code class="fenced-code-block language-python">vga <span class="token operator">=</span> VgaDriver<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> VideoRegion<span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">,</span> VideoRegion<span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"build/vga_driver.v"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    v <span class="token operator">=</span> verilog<span class="token punctuation">.</span>convert<span class="token punctuation">(</span>vga<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"vga_driver_svga"</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Wrote vga module"</span><span class="token punctuation">)</span></code></pre>
<p>I try to write display drivers with an easy way to set timing configurations. If I was doing a more general purpose display, I would add a bus interface to set registers to change the timing in run-time.</p>
<h2 class="atx" id="rendering-lcd">Rendering LCD</h2>
<p>Since the gameboy's native LCD panel is much smaller than the 800x600 resolution, I am going add some borders and upsample the incoming stream. These become easy when using a nice stream format.</p>
<h3 class="atx" id="vertical-upsample">Vertical upsample</h3>
<p>First I upsample each incoming pixel 4 times we end up with a 640x576 resolution. Upsampling vertically requires storing the incoming video stream for one line. When a line is finished, the buffer is used as the video source N times.</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">class</span> <span class="token class-name">UpsampleVertical</span><span class="token punctuation">(</span>wiring<span class="token punctuation">.</span>Component<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> divide <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">160</span><span class="token punctuation">,</span> shape <span class="token operator">=</span> signature<span class="token punctuation">.</span>PixelLayout<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>divide <span class="token operator">=</span> divide <span class="token comment"># Multiplies the height of incoming stream</span>
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token comment"># Width of incoming stream</span>
        self<span class="token punctuation">.</span>shape <span class="token operator">=</span> shape <span class="token comment"># Shape of incoming stream data</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">"consume"</span><span class="token punctuation">:</span> In<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>VideoStream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"produce"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>VideoStream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">elaborate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> platform<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> Module<span class="token punctuation">(</span><span class="token punctuation">)</span>

        sync_flag <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Caches a line of pixels</span>
        line_buffer <span class="token operator">=</span> m<span class="token punctuation">.</span>submodules<span class="token punctuation">.</span><span class="token builtin">buffer</span> <span class="token operator">=</span> memory<span class="token punctuation">.</span>Memory<span class="token punctuation">(</span>shape <span class="token operator">=</span> self<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> depth <span class="token operator">=</span> self<span class="token punctuation">.</span>width<span class="token punctuation">,</span> init <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment"># Write to cache</span>
        write_port <span class="token operator">=</span> line_buffer<span class="token punctuation">.</span>write_port<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># Read from cache</span>
        read_port <span class="token operator">=</span> line_buffer<span class="token punctuation">.</span>read_port<span class="token punctuation">(</span>domain <span class="token operator">=</span> <span class="token string">"comb"</span><span class="token punctuation">)</span>

        addr <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span>
        addr_last <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>

        m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> addr_last<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>addr <span class="token operator">==</span> self<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>

        line_counter <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>divide<span class="token punctuation">)</span><span class="token punctuation">)</span>
        active <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>

        m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> active<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>line_counter <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>valid <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Capture vsync flag</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>vsync<span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> sync_flag<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token comment"># Only send vsync flag on last line of upsample</span>
        m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>vsync<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>sync_flag <span class="token operator">&amp;</span> <span class="token punctuation">(</span>line_counter <span class="token operator">==</span> self<span class="token punctuation">.</span>divide <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>addr_last<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>ready<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>vsync<span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> sync_flag<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>addr_last<span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> addr<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>line_counter <span class="token operator">==</span> self<span class="token punctuation">.</span>divide <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> line_counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> line_counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>line_counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> addr<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>addr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>active<span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> <span class="token punctuation">[</span>
                self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>data<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>valid<span class="token punctuation">)</span><span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>ready<span class="token punctuation">)</span>
            <span class="token punctuation">]</span>

            <span class="token comment"># Write to buffer</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> write_port<span class="token punctuation">.</span>en<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>ready<span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> write_port<span class="token punctuation">.</span>data<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> write_port<span class="token punctuation">.</span>addr<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> read_port<span class="token punctuation">.</span>addr<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>data<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>read_port<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

        <span class="token keyword">return</span> m</code></pre>
<p>To confirm behavior, I use two helper functions to read and write from the streams in the amaranth simulator:</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">stream_put</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> stream<span class="token punctuation">,</span> data<span class="token punctuation">,</span> vsync<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ctx<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span>data<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    ctx<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span>vsync<span class="token punctuation">,</span> vsync<span class="token punctuation">)</span>
    ctx<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span>valid<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>stream<span class="token punctuation">.</span>ready<span class="token punctuation">)</span>
    ctx<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span>valid<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">stream_get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> stream<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> vsync<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ctx<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span>ready<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    data<span class="token punctuation">,</span> vs <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sample<span class="token punctuation">(</span>stream<span class="token punctuation">.</span>data<span class="token punctuation">,</span> stream<span class="token punctuation">.</span>vsync<span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>stream<span class="token punctuation">.</span>valid<span class="token punctuation">)</span>
    <span class="token keyword">assert</span> expect <span class="token operator">==</span> data
    <span class="token keyword">assert</span> vs <span class="token operator">==</span> vsync
    ctx<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>stream<span class="token punctuation">.</span>ready<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></code></pre>
<p>With that I can make sure that for each line in I get the same line back 4 times.</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">def</span> <span class="token function">tb_vertical_resample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dut <span class="token operator">=</span> UpsampleVertical<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> shape <span class="token operator">=</span> unsigned<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">write_process</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">await</span> stream_put<span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> dut<span class="token punctuation">.</span>consume<span class="token punctuation">,</span> j<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_process</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">await</span> stream_get<span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> dut<span class="token punctuation">.</span>produce<span class="token punctuation">,</span> j <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    sim <span class="token operator">=</span> Simulator<span class="token punctuation">(</span>dut<span class="token punctuation">)</span>
    sim<span class="token punctuation">.</span>add_clock<span class="token punctuation">(</span><span class="token number">1e-8</span><span class="token punctuation">)</span>
    sim<span class="token punctuation">.</span>add_testbench<span class="token punctuation">(</span>write_process<span class="token punctuation">)</span>
    sim<span class="token punctuation">.</span>add_testbench<span class="token punctuation">(</span>read_process<span class="token punctuation">)</span>

    <span class="token keyword">with</span> sim<span class="token punctuation">.</span>write_vcd<span class="token punctuation">(</span><span class="token string">"bench/tb_upsample_vertical.vcd"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sim<span class="token punctuation">.</span>run_until<span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">*</span><span class="token number">1e-8</span><span class="token punctuation">)</span></code></pre>
<p>Although not the most intense testing, it gives me a baseline of operation. This module could be made a bit simpler by having the incoming stream provide an hsync flag. This would allow the module to not have to internally track pixel position. If I start to have problems with the wider display pipeline, I can return and check finer cases.</p>
<h3 class="atx" id="horizontal-upsample">Horizontal upsample</h3>
<p>The horizontal upsample is a similar process, but instead of needing to cache an entire line I only need to cache one instance of the stream data, as well as the vsync flag.</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">class</span> <span class="token class-name">UpsampleHorizontal</span><span class="token punctuation">(</span>wiring<span class="token punctuation">.</span>Component<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> divide<span class="token punctuation">,</span> shape <span class="token operator">=</span> signature<span class="token punctuation">.</span>PixelLayout<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>divide <span class="token operator">=</span> divide
        self<span class="token punctuation">.</span>shape <span class="token operator">=</span> shape
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">"consume"</span><span class="token punctuation">:</span> In<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>VideoStream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"produce"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>VideoStream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">elaborate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> platform<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> Module<span class="token punctuation">(</span><span class="token punctuation">)</span>

        sync_reg <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>
        data_reg <span class="token operator">=</span> Signal<span class="token punctuation">(</span>self<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

        counter <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>divide<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># Copy data to registers</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>valid <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready<span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> data_reg<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> sync_reg<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>vsync<span class="token punctuation">)</span>

        <span class="token comment"># Keep track of how many copies of data we have sent</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>ready<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>counter <span class="token operator">==</span> self<span class="token punctuation">.</span>divide <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>counter <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Data from stream</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>data<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>valid<span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>ready<span class="token punctuation">)</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># From registers</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>data<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>data_reg<span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># Explicit block incoming stream</span>

        <span class="token comment"># Sync flag on last sampled value</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>counter <span class="token operator">==</span> self<span class="token punctuation">.</span>divide <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>vsync<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>sync_reg<span class="token punctuation">)</span>

        <span class="token keyword">return</span> m</code></pre>
<p> Verifying behavior is similar to vertical upsampling:</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">def</span> <span class="token function">tb_horizontal_resample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dut <span class="token operator">=</span> UpsampleHorizontal<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> shape <span class="token operator">=</span> unsigned<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">write_process</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">await</span> stream_put<span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> dut<span class="token punctuation">.</span>consume<span class="token punctuation">,</span> j<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_process</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">await</span> stream_get<span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> dut<span class="token punctuation">.</span>produce<span class="token punctuation">,</span> math<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>j <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    sim <span class="token operator">=</span> Simulator<span class="token punctuation">(</span>dut<span class="token punctuation">)</span>
    sim<span class="token punctuation">.</span>add_clock<span class="token punctuation">(</span><span class="token number">1e-8</span><span class="token punctuation">)</span>
    sim<span class="token punctuation">.</span>add_testbench<span class="token punctuation">(</span>write_process<span class="token punctuation">)</span>
    sim<span class="token punctuation">.</span>add_testbench<span class="token punctuation">(</span>read_process<span class="token punctuation">)</span>

    <span class="token keyword">with</span> sim<span class="token punctuation">.</span>write_vcd<span class="token punctuation">(</span><span class="token string">"bench/tb_upsample_horizontal.vcd"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sim<span class="token punctuation">.</span>run_until<span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">*</span><span class="token number">1e-8</span><span class="token punctuation">)</span></code></pre>
<h3 class="atx" id="border">Border</h3>
<p>The gameboy LCD does not evenly fit into my 800x600 display, so I also want to add padding so the graphics are centered on the screen. I can insert fill pixels at the start and end of each line, and each frame.</p>
<p>The vertical border inserts 12 pixels at the start and end of each line. When I have time to loop back to this, I can make this bit more efficient by sharing a counter with the upsampler, and inserting 3 pixels before upsampling. But for now, this is functional.</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">class</span> <span class="token class-name">VerticalBorder</span><span class="token punctuation">(</span>wiring<span class="token punctuation">.</span>Component<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> margin <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"r"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"g"</span><span class="token punctuation">:</span> <span class="token number">0x6</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token number">0x6</span><span class="token punctuation">}</span><span class="token punctuation">,</span> shape <span class="token operator">=</span> signature<span class="token punctuation">.</span>PixelLayout<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>margin <span class="token operator">=</span> margin
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> width
        self<span class="token punctuation">.</span>fill <span class="token operator">=</span> Const<span class="token punctuation">(</span>fill<span class="token punctuation">,</span> shape<span class="token punctuation">)</span>

        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">"consume"</span><span class="token punctuation">:</span> In<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>VideoStream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"produce"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>VideoStream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">elaborate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> platform<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> Module<span class="token punctuation">(</span><span class="token punctuation">)</span>

        fill_pixels <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>margin <span class="token operator">*</span> self<span class="token punctuation">.</span>width
        sync_location <span class="token operator">=</span> self<span class="token punctuation">.</span>margin <span class="token operator">*</span> self<span class="token punctuation">.</span>width

        active <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>
        pix_counter <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>fill_pixels<span class="token punctuation">)</span><span class="token punctuation">)</span>

        m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>vsync<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>pix_counter <span class="token operator">==</span> sync_location <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token comment"># When we receive a vsync, start border</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>valid <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>vsync<span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> active<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> pix_counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token comment"># Active</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>active<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Pass stream through (don't pass vsync)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> <span class="token punctuation">[</span>
                self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>valid<span class="token punctuation">)</span><span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>ready<span class="token punctuation">)</span><span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>data<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Fill border</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>data<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fill<span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

            <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>ready<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># How many pixels have been filled</span>
                <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>pix_counter <span class="token operator">==</span> fill_pixels <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> active<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> pix_counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> pix_counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>pix_counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> m</code></pre>
<p>The horizontal border inserts blank pixels at the start and end of the frame.</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">class</span> <span class="token class-name">HorizontalBorder</span><span class="token punctuation">(</span>wiring<span class="token punctuation">.</span>Component<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> margin <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"r"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"g"</span><span class="token punctuation">:</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token number">0x6</span><span class="token punctuation">}</span><span class="token punctuation">,</span> shape <span class="token operator">=</span> signature<span class="token punctuation">.</span>PixelLayout<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>margin <span class="token operator">=</span> margin
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> width
        self<span class="token punctuation">.</span>fill <span class="token operator">=</span> Const<span class="token punctuation">(</span>fill<span class="token punctuation">,</span> shape<span class="token punctuation">)</span>

        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">"consume"</span><span class="token punctuation">:</span> In<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>VideoStream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"produce"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>VideoStream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">elaborate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> platform<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> Module<span class="token punctuation">(</span><span class="token punctuation">)</span>

        sync_reg <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>
        counter <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span>

        active <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>

        active_start <span class="token operator">=</span> self<span class="token punctuation">.</span>margin
        active_end <span class="token operator">=</span> self<span class="token punctuation">.</span>width <span class="token operator">-</span> self<span class="token punctuation">.</span>margin

        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span><span class="token punctuation">(</span>counter <span class="token operator">&gt;=</span> active_start<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>counter <span class="token operator">&lt;</span> active_end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> active<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        counter_last <span class="token operator">=</span> Signal<span class="token punctuation">(</span><span class="token punctuation">)</span>

        m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> counter_last<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>counter <span class="token operator">==</span> self<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>

        m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>vsync<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>sync_reg <span class="token operator">&amp;</span> counter_last<span class="token punctuation">)</span>

        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>ready<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>vsync<span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> sync_reg<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>counter_last<span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> counter<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>valid <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready <span class="token operator">&amp;</span> self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>vsync<span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>sync <span class="token operator">+=</span> sync_reg<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">with</span> m<span class="token punctuation">.</span>If<span class="token punctuation">(</span>active<span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> <span class="token punctuation">[</span>
                self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>data<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>valid<span class="token punctuation">)</span><span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>consume<span class="token punctuation">.</span>ready<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>ready<span class="token punctuation">)</span>
            <span class="token punctuation">]</span>
        <span class="token keyword">with</span> m<span class="token punctuation">.</span>Else<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>valid<span class="token punctuation">.</span>eq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            m<span class="token punctuation">.</span>d<span class="token punctuation">.</span>comb <span class="token operator">+=</span> self<span class="token punctuation">.</span>produce<span class="token punctuation">.</span>data<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fill<span class="token punctuation">)</span>

        <span class="token keyword">return</span> m</code></pre>
<p>Here I use the vsync flag coming in to start filling, and produce the vsync when I'm halfway through the border fill. This means that half the fill will be at the bottom of the screen, and then align to the top after the vsync flag is sent.</p>
<p>Both of these modules have to keep track of when to send the vsync flag, because I need it to align to the end of display.</p>
<h2 class="atx" id="putting-it-together">Putting it together</h2>
<p>I made a wrapper which connects together this display pipeline. A 160x144 video stream goes in, and a 800x600 stream comes out.</p>
<pre><code class="fenced-code-block language-python"><span class="token keyword">class</span> <span class="token class-name">Resize</span><span class="token punctuation">(</span>wiring<span class="token punctuation">.</span>Component<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> upsample<span class="token punctuation">,</span> border<span class="token punctuation">,</span> shape <span class="token operator">=</span> signature<span class="token punctuation">.</span>PixelLayout<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>upsample <span class="token operator">=</span> upsample
        self<span class="token punctuation">.</span>border <span class="token operator">=</span> border
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">"consume"</span><span class="token punctuation">:</span> In<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>VideoStream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"produce"</span><span class="token punctuation">:</span> Out<span class="token punctuation">(</span>signature<span class="token punctuation">.</span>VideoStream<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">elaborate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> platform<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> Module<span class="token punctuation">(</span><span class="token punctuation">)</span>

        m<span class="token punctuation">.</span>submodules<span class="token punctuation">.</span>upsample <span class="token operator">=</span> self<span class="token punctuation">.</span>upsample
        m<span class="token punctuation">.</span>submodules<span class="token punctuation">.</span>border <span class="token operator">=</span> self<span class="token punctuation">.</span>border

        wiring<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>m<span class="token punctuation">,</span> wiring<span class="token punctuation">.</span>flipped<span class="token punctuation">(</span>self<span class="token punctuation">.</span>consume<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>upsample<span class="token punctuation">.</span>consume<span class="token punctuation">)</span>
        wiring<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>m<span class="token punctuation">,</span> self<span class="token punctuation">.</span>upsample<span class="token punctuation">.</span>produce<span class="token punctuation">,</span> self<span class="token punctuation">.</span>border<span class="token punctuation">.</span>consume<span class="token punctuation">)</span>
        wiring<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>m<span class="token punctuation">,</span> wiring<span class="token punctuation">.</span>flipped<span class="token punctuation">(</span>self<span class="token punctuation">.</span>produce<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>border<span class="token punctuation">.</span>produce<span class="token punctuation">)</span>

        <span class="token keyword">return</span> m</code></pre>
<p>I also wrote a module which sets a framebuffer and repeatedly streams out data. After converting my amaranth modules to verilog, I place them in the vivado block diagram.</p>
<p><img alt="Screenshot 2025-03-12 133928.png" src="file:///C:/Users/magen/Documents/Blog/Resources/gameboy/Screenshot%202025-03-12%20133928.png"></p>
<p>This displayed correctly on my VGA monitor, which is a satisfying step. With a way to check output, I am going to move onto making the components of the picture-processing unit.</p>
</article>
</body>
</html>